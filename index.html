<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Tracker - Erreiche deine Ziele</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1f2937;
            --light: #f3f4f6;
            --white: #ffffff;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
        }

        .tab-btn {
            padding: 10px 20px;
            border: none;
            background: var(--light);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
        }

        .content-area {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            min-height: 600px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--light), white);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .stat-title {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--light);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.05);
        }

        /* Input Form Styles */
        .form-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.05);
        }

        .form-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: var(--dark);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--dark);
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--light);
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* Habit Tracker Styles */
        .habit-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .habit-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .habit-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .habit-card.completed {
            background: var(--secondary);
            color: white;
        }

        .habit-icon {
            font-size: 30px;
            margin-bottom: 10px;
        }

        /* Measurements Chart */
        .measurements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .measurement-item {
            background: var(--light);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .measurement-label {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 5px;
        }

        .measurement-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
        }

        /* Rewards System */
        .rewards-container {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            border-radius: 15px;
            padding: 20px;
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }

        .points-display {
            font-size: 48px;
            font-weight: bold;
            margin: 10px 0;
        }

        /* Journal Styles */
        .journal-entry {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .journal-date {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 10px;
        }

        .journal-content {
            line-height: 1.6;
        }

        /* Custom Chart Styles */
        .custom-chart-bar {
            display: inline-block;
            width: 100%;
            border-radius: 5px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .weight-point {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #6366f1;
            border: 3px solid white;
            transform: translate(-50%, -50%);
            cursor: pointer;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .weight-point:hover {
            transform: translate(-50%, -50%) scale(1.5);
        }

        .weight-line {
            position: absolute;
            height: 2px;
            background: #6366f1;
            transform-origin: left center;
        }

        .chart-y-axis {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 40px;
            width: 50px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-size: 12px;
            color: #6b7280;
        }

        .chart-x-axis {
            position: absolute;
            bottom: 0;
            left: 60px;
            right: 0;
            height: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #6b7280;
        }

        .chart-grid {
            position: absolute;
            left: 60px;
            right: 0;
            top: 0;
            bottom: 40px;
        }

        .grid-line {
            position: absolute;
            width: 100%;
            height: 1px;
            background: #e5e7eb;
        }

        .habit-heatmap {
            display: grid;
            gap: 5px;
            margin: 20px 0;
        }

        .heatmap-cell {
            aspect-ratio: 1;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .heatmap-cell:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
            }

            .nav-tabs {
                flex-wrap: wrap;
                justify-content: center;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üéØ Life Tracker</div>
            <div class="nav-tabs">
                <button class="tab-btn active" onclick="switchTab('dashboard')">Dashboard</button>
                <button class="tab-btn" onclick="switchTab('input')">Eingabe</button>
                <button class="tab-btn" onclick="switchTab('settings')">Einstellungen</button>
            </div>
        </div>

        <div class="content-area">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <h2 style="margin-bottom: 30px;">Dein Fortschritt bis zum 08.08.2025</h2>
                
                <!-- Punktesystem -->
                <div class="rewards-container">
                    <h3>üèÜ Deine Punkte</h3>
                    <div class="points-display" id="totalPoints">0</div>
                    <p>Sammle Punkte f√ºr jeden erreichten Habit!</p>
                </div>

                <!-- Gewichtsverlauf -->
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-title">Aktuelles Gewicht</div>
                        <div class="stat-value" id="currentWeight">94.1 kg</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="weightProgress" style="width: 0%"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 12px; color: #6b7280;">
                            <span>Start: 94.1 kg</span>
                            <span>Ziel: 85 kg</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-title">Tage bis zum Ziel</div>
                        <div class="stat-value" id="daysRemaining">57</div>
                        <div style="font-size: 14px; color: #6b7280;">
                            Durchschnittlich 0.16 kg/Tag n√∂tig
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-title">Wochenziel</div>
                        <div class="stat-value" id="weeklyGoal">-1.1 kg</div>
                        <div style="font-size: 14px; color: #6b7280;">
                            Gesundes Tempo!
                        </div>
                    </div>
                </div>

                <!-- Gewichtschart -->
                <div class="chart-container">
                    <h3>üìä Gewichtsverlauf</h3>
                    <div id="weightChart" style="position: relative; height: 300px; margin: 20px 0;">
                        <!-- Custom weight chart will be rendered here -->
                    </div>
                </div>

                <!-- Habit Tracker Chart -->
                <div class="chart-container">
                    <h3>üéØ Habit Tracker - Wochen√ºbersicht</h3>
                    <div id="habitChart" style="margin: 20px 0;">
                        <!-- Custom habit chart will be rendered here -->
                    </div>
                </div>

                <!-- Daily Habit Details Table -->
                <div class="form-section">
                    <h3>üìÖ T√§gliche Habit-√úbersicht (letzte 7 Tage)</h3>
                    <div style="overflow-x: auto;">
                        <table id="dailyHabitTable" style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                            <!-- Table will be populated dynamically -->
                        </table>
                    </div>
                </div>

                <!-- Daily Weight Changes -->
                <div class="form-section">
                    <h3>‚öñÔ∏è T√§gliche Gewichtsver√§nderung</h3>
                    <div id="dailyWeightChanges">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>

                <!-- K√∂rperma√üe -->
                <div class="form-section">
                    <h3>K√∂rperma√üe (Letzte Messung)</h3>
                    <div class="measurements-grid">
                        <div class="measurement-item">
                            <div class="measurement-label">Bauchumfang</div>
                            <div class="measurement-value" id="measureBauch">99.3 cm</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-label">Oberschenkel</div>
                            <div class="measurement-value" id="measureOberschenkel">52.9 cm</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-label">Unterschenkel</div>
                            <div class="measurement-value" id="measureUnterschenkel">39.2 cm</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-label">Bizeps</div>
                            <div class="measurement-value" id="measureBizeps">31.4 cm</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-label">Brust</div>
                            <div class="measurement-value" id="measureBrust">102.8 cm</div>
                        </div>
                    </div>
                </div>

                <!-- Habits Overview -->
                <div class="form-section">
                    <h3>Heutige Habits</h3>
                    <div class="habit-grid" id="habitOverview">
                        <!-- Habits werden dynamisch geladen -->
                    </div>
                </div>

                <!-- Journal Preview -->
                <div class="form-section">
                    <h3>üìù Tagebucheintr√§ge (letzte 7 Tage)</h3>
                    <div id="journalPreview" style="max-height: 500px; overflow-y: auto;">
                        <!-- Journal entries werden dynamisch geladen -->
                    </div>
                </div>
            </div>

            <!-- Input Tab -->
            <div id="input" class="tab-content">
                <h2 style="margin-bottom: 30px;">T√§gliche Eingabe</h2>

                <!-- Datum -->
                <div class="form-section">
                    <div class="form-group">
                        <label for="inputDate">Datum</label>
                        <input type="date" id="inputDate" value="">
                    </div>
                </div>

                <!-- Gewicht -->
                <div class="form-section">
                    <div class="form-title">üí™ Gewicht</div>
                    <div class="form-group">
                        <label for="inputWeight">Gewicht (kg)</label>
                        <input type="number" id="inputWeight" step="0.1" placeholder="z.B. 93.5">
                    </div>
                </div>

                <!-- K√∂rperma√üe (nur Sonntags) -->
                <div class="form-section" id="measurementsSection" style="display: none;">
                    <div class="form-title">üìè K√∂rperma√üe (W√∂chentlich)</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label for="inputBauch">Bauchumfang (cm)</label>
                            <input type="number" id="inputBauch" step="0.1" placeholder="99.3">
                        </div>
                        <div class="form-group">
                            <label for="inputOberschenkel">Oberschenkel (cm)</label>
                            <input type="number" id="inputOberschenkel" step="0.1" placeholder="52.9">
                        </div>
                        <div class="form-group">
                            <label for="inputUnterschenkel">Unterschenkel (cm)</label>
                            <input type="number" id="inputUnterschenkel" step="0.1" placeholder="39.2">
                        </div>
                        <div class="form-group">
                            <label for="inputBizeps">Bizeps (cm)</label>
                            <input type="number" id="inputBizeps" step="0.1" placeholder="31.4">
                        </div>
                        <div class="form-group">
                            <label for="inputBrust">Brust (cm)</label>
                            <input type="number" id="inputBrust" step="0.1" placeholder="102.8">
                        </div>
                    </div>
                </div>

                <!-- Habits -->
                <div class="form-section">
                    <div class="form-title">üéØ Habits</div>
                    <div class="habit-grid" id="habitInput">
                        <!-- Habits werden dynamisch geladen -->
                    </div>
                    <button class="btn btn-secondary" onclick="showAddHabitDialog()">+ Neuer Habit</button>
                </div>

                <!-- Journal -->
                <div class="form-section">
                    <div class="form-title">üìù Tagebuch</div>
                    <div class="form-group">
                        <label for="inputJournal">Wie war dein Tag?</label>
                        <textarea id="inputJournal" rows="5" placeholder="Was hast du heute gemacht? Wie f√ºhlst du dich?"></textarea>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="saveDaily()">üíæ Speichern</button>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <h2 style="margin-bottom: 30px;">Einstellungen</h2>

                <div class="form-section">
                    <div class="form-title">‚öôÔ∏è Allgemeine Einstellungen</div>
                    
                    <div class="form-group">
                        <label for="startWeight">Startgewicht (kg)</label>
                        <input type="number" id="startWeight" step="0.1" value="94.1">
                    </div>

                    <div class="form-group">
                        <label for="targetWeight">Zielgewicht (kg)</label>
                        <input type="number" id="targetWeight" step="0.1" value="85">
                    </div>

                    <div class="form-group">
                        <label for="targetDate">Zieldatum</label>
                        <input type="date" id="targetDate" value="2025-08-08">
                    </div>

                    <div class="form-group">
                        <label for="weekStart">Wochenbeginn</label>
                        <select id="weekStart">
                            <option value="1">Montag</option>
                            <option value="0">Sonntag</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="measurementDay">Messtag (K√∂rperma√üe)</label>
                        <select id="measurementDay">
                            <option value="0">Sonntag</option>
                            <option value="1">Montag</option>
                            <option value="2">Dienstag</option>
                            <option value="3">Mittwoch</option>
                            <option value="4">Donnerstag</option>
                            <option value="5">Freitag</option>
                            <option value="6">Samstag</option>
                        </select>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-title">üéØ Habits verwalten</div>
                    <div id="habitsList">
                        <!-- Habits Liste wird dynamisch geladen -->
                    </div>
                </div>

                <button class="btn btn-primary" onclick="saveSettings()">üíæ Einstellungen speichern</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize data structure
        let appData = {
            settings: {
                startWeight: 94.1,
                targetWeight: 85,
                targetDate: '2025-08-08',
                weekStart: 1,
                measurementDay: 0
            },
            habits: [
                { id: 1, name: 'Rennrad fahren', icon: 'üö¥', frequency: 'weekly', target: 3, color: '#ef4444' },
                { id: 2, name: 'Yoga', icon: 'üßò', frequency: 'weekly', target: 5, color: '#10b981' },
                { id: 3, name: 'Kein Alkohol', icon: 'üö´', frequency: 'daily', target: 1, color: '#6366f1' },
                { id: 4, name: 'Wenig Zucker', icon: 'üç¨', frequency: 'daily', target: 1, color: '#f59e0b' },
                { id: 5, name: 'Obst/Gem√ºse', icon: 'ü•ó', frequency: 'daily', target: 1, color: '#8b5cf6' }
            ],
            dailyData: {},
            points: 0
        };

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('lifeTrackerData');
            if (saved) {
                appData = JSON.parse(saved);
            }
            updateDashboard();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('lifeTrackerData', JSON.stringify(appData));
        }

        // Switch tabs
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            
            // Find and activate the correct button
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => {
                if (btn.textContent.toLowerCase().includes(tabName.toLowerCase()) || 
                    (tabName === 'dashboard' && btn.textContent === 'Dashboard') ||
                    (tabName === 'input' && btn.textContent === 'Eingabe') ||
                    (tabName === 'settings' && btn.textContent === 'Einstellungen')) {
                    btn.classList.add('active');
                }
            });
            
            if (tabName === 'dashboard') {
                // Delay chart rendering to ensure DOM is ready
                setTimeout(() => {
                    updateDashboard();
                }, 100);
            } else if (tabName === 'input') {
                loadInputForm();
            } else if (tabName === 'settings') {
                loadSettings();
            }
        }

        // Calculate days remaining
        function calculateDaysRemaining() {
            const today = new Date();
            const target = new Date(appData.settings.targetDate);
            const diffTime = Math.abs(target - today);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        // Update Dashboard
        function updateDashboard() {
            // Calculate current weight (latest entry)
            const dates = Object.keys(appData.dailyData).sort().reverse();
            const latestWeight = dates.length > 0 && appData.dailyData[dates[0]].weight 
                ? appData.dailyData[dates[0]].weight 
                : appData.settings.startWeight;
            
            document.getElementById('currentWeight').textContent = latestWeight + ' kg';
            
            // Calculate progress
            const totalToLose = appData.settings.startWeight - appData.settings.targetWeight;
            const currentLoss = appData.settings.startWeight - latestWeight;
            const progress = (currentLoss / totalToLose) * 100;
            document.getElementById('weightProgress').style.width = Math.max(0, Math.min(100, progress)) + '%';
            
            // Days remaining
            const daysRemaining = calculateDaysRemaining();
            document.getElementById('daysRemaining').textContent = daysRemaining;
            
            // Weekly goal
            const remainingWeight = latestWeight - appData.settings.targetWeight;
            const weeksRemaining = daysRemaining / 7;
            const weeklyGoal = (remainingWeight / weeksRemaining).toFixed(1);
            document.getElementById('weeklyGoal').textContent = '-' + weeklyGoal + ' kg';
            
            // Update points
            document.getElementById('totalPoints').textContent = appData.points;
            
            // Load habits overview
            loadHabitsOverview();
            
            // Load journal preview
            loadJournalPreview();
            
            // Update weight chart
            updateWeightChart();
            
            // Update habit chart
            updateHabitChart();
            
            // Update daily habit table
            updateDailyHabitTable();
            
            // Update daily weight changes
            updateDailyWeightChanges();
        }

        // Load habits overview
        function loadHabitsOverview() {
            const today = new Date().toISOString().split('T')[0];
            const todayData = appData.dailyData[today] || {};
            const habitOverview = document.getElementById('habitOverview');
            
            habitOverview.innerHTML = appData.habits.map(habit => {
                const completed = todayData.habits && todayData.habits[habit.id];
                return `
                    <div class="habit-card ${completed ? 'completed' : ''}" style="border-color: ${habit.color}">
                        <div class="habit-icon">${habit.icon}</div>
                        <div>${habit.name}</div>
                    </div>
                `;
            }).join('');
        }

        // Load journal preview
        function loadJournalPreview() {
            const dates = Object.keys(appData.dailyData).sort().reverse().slice(0, 7);
            const journalPreview = document.getElementById('journalPreview');
            
            if (dates.length === 0) {
                journalPreview.innerHTML = '<p style="text-align: center; color: #6b7280;">Noch keine Eintr√§ge vorhanden</p>';
                return;
            }
            
            journalPreview.innerHTML = dates.map(date => {
                const entry = appData.dailyData[date];
                const dateObj = new Date(date);
                const weekday = dateObj.toLocaleDateString('de-DE', { weekday: 'long' });
                
                return `
                    <div class="journal-entry">
                        <div class="journal-date" style="font-weight: bold; color: #6366f1;">
                            ${weekday}, ${dateObj.toLocaleDateString('de-DE')}
                        </div>
                        ${entry.journal ? `<div class="journal-content">${entry.journal}</div>` : '<div style="color: #9ca3af; font-style: italic;">Kein Eintrag</div>'}
                    </div>
                `;
            }).join('');
        }

        // Update weight chart - Custom Implementation
        function updateWeightChart() {
            const container = document.getElementById('weightChart');
            if (!container) return;
            
            const dates = Object.keys(appData.dailyData).sort();
            const weights = [];
            
            // Collect weight data
            dates.forEach(date => {
                if (appData.dailyData[date] && appData.dailyData[date].weight) {
                    weights.push({
                        date: date,
                        weight: appData.dailyData[date].weight
                    });
                }
            });
            
            if (weights.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 40px;">Noch keine Gewichtsdaten vorhanden. Trage dein Gewicht ein!</p>';
                return;
            }
            
            // Find min and max for scaling
            const allWeights = weights.map(w => w.weight);
            const minWeight = Math.min(...allWeights, appData.settings.targetWeight) - 2;
            const maxWeight = Math.max(...allWeights, appData.settings.startWeight) + 2;
            const range = maxWeight - minWeight;
            
            // Create custom chart
            let html = `
                <div style="position: relative; height: 100%; padding-left: 60px;">
                    <!-- Y-Axis -->
                    <div class="chart-y-axis">
            `;
            
            // Add Y-axis labels
            for (let i = 0; i <= 5; i++) {
                const weight = maxWeight - (range * i / 5);
                html += `<div style="text-align: right; padding-right: 10px;">${weight.toFixed(1)}</div>`;
            }
            
            html += `
                    </div>
                    <!-- Grid and Chart Area -->
                    <div class="chart-grid">
            `;
            
            // Add horizontal grid lines
            for (let i = 0; i <= 5; i++) {
                const top = (i * 100 / 5);
                html += `<div class="grid-line" style="top: ${top}%;"></div>`;
            }
            
            // Add target line
            const targetY = ((maxWeight - appData.settings.targetWeight) / range) * 100;
            html += `<div style="position: absolute; width: 100%; height: 2px; background: #10b981; border-style: dashed; top: ${targetY}%; opacity: 0.5;"></div>`;
            html += `<div style="position: absolute; right: 10px; top: ${targetY}%; transform: translateY(-50%); background: #10b981; color: white; padding: 2px 8px; border-radius: 5px; font-size: 12px;">Ziel: ${appData.settings.targetWeight}kg</div>`;
            
            // Plot points and lines
            weights.forEach((point, index) => {
                const x = (index / (weights.length - 1 || 1)) * 100;
                const y = ((maxWeight - point.weight) / range) * 100;
                
                // Add point
                html += `
                    <div class="weight-point" 
                         style="left: ${x}%; top: ${y}%;"
                         title="${new Date(point.date).toLocaleDateString('de-DE')}: ${point.weight}kg">
                    </div>
                `;
                
                // Add line to next point
                if (index < weights.length - 1) {
                    const nextX = ((index + 1) / (weights.length - 1)) * 100;
                    const nextY = ((maxWeight - weights[index + 1].weight) / range) * 100;
                    
                    const length = Math.sqrt(Math.pow(nextX - x, 2) + Math.pow(nextY - y, 2));
                    const angle = Math.atan2(nextY - y, nextX - x) * 180 / Math.PI;
                    
                    html += `
                        <div class="weight-line" 
                             style="left: ${x}%; top: ${y}%; width: ${length}%; transform: rotate(${angle}deg);">
                        </div>
                    `;
                }
                
                // Add value label for last 3 points
                if (index >= weights.length - 3) {
                    html += `
                        <div style="position: absolute; left: ${x}%; top: ${y}%; transform: translate(-50%, -30px); 
                                    background: #6366f1; color: white; padding: 2px 6px; border-radius: 5px; 
                                    font-size: 11px; font-weight: bold;">
                            ${point.weight}kg
                        </div>
                    `;
                }
            });
            
            html += `
                    </div>
                    <!-- X-Axis -->
                    <div class="chart-x-axis">
            `;
            
            // Add X-axis labels (show max 7 dates)
            const step = Math.max(1, Math.floor(weights.length / 7));
            weights.forEach((point, index) => {
                if (index % step === 0 || index === weights.length - 1) {
                    const date = new Date(point.date);
                    html += `<div style="font-size: 11px;">${date.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit' })}</div>`;
                }
            });
            
            html += `
                    </div>
                </div>
            `;
            
            // Add statistics
            const currentWeight = weights[weights.length - 1].weight;
            const totalLoss = appData.settings.startWeight - currentWeight;
            const remaining = currentWeight - appData.settings.targetWeight;
            
            html += `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 20px;">
                    <div style="background: linear-gradient(135deg, #6366f1, #4f46e5); color: white; padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 12px; opacity: 0.9;">Bisheriger Verlust</div>
                        <div style="font-size: 24px; font-weight: bold;">${totalLoss.toFixed(1)} kg</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 12px; opacity: 0.9;">Noch zu verlieren</div>
                        <div style="font-size: 24px; font-weight: bold;">${remaining.toFixed(1)} kg</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 12px; opacity: 0.9;">Fortschritt</div>
                        <div style="font-size: 24px; font-weight: bold;">${((totalLoss / (appData.settings.startWeight - appData.settings.targetWeight)) * 100).toFixed(0)}%</div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // Load input form
        function loadInputForm() {
            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('inputDate').value = today;
            
            // Add date change listener
            document.getElementById('inputDate').addEventListener('change', loadDataForDate);
            
            // Load data for current date
            loadDataForDate();
        }
        
        // Load data for specific date
        function loadDataForDate() {
            const selectedDate = document.getElementById('inputDate').value;
            
            // Check if it's measurement day
            const dayOfWeek = new Date(selectedDate).getDay();
            if (dayOfWeek === appData.settings.measurementDay) {
                document.getElementById('measurementsSection').style.display = 'block';
            } else {
                document.getElementById('measurementsSection').style.display = 'none';
            }
            
            // Clear all inputs
            document.getElementById('inputWeight').value = '';
            document.getElementById('inputJournal').value = '';
            document.getElementById('inputBauch').value = '';
            document.getElementById('inputOberschenkel').value = '';
            document.getElementById('inputUnterschenkel').value = '';
            document.getElementById('inputBizeps').value = '';
            document.getElementById('inputBrust').value = '';
            
            // Load habits for input
            const habitInput = document.getElementById('habitInput');
            habitInput.innerHTML = appData.habits.map(habit => `
                <div class="habit-card" onclick="toggleHabit(${habit.id})" id="habit-${habit.id}" style="border-color: ${habit.color}">
                    <div class="habit-icon">${habit.icon}</div>
                    <div>${habit.name}</div>
                </div>
            `).join('');
            
            // Load existing data if available
            if (appData.dailyData[selectedDate]) {
                const data = appData.dailyData[selectedDate];
                if (data.weight) document.getElementById('inputWeight').value = data.weight;
                if (data.journal) document.getElementById('inputJournal').value = data.journal;
                
                // Load measurements if available
                if (data.measurements) {
                    if (data.measurements.bauch) document.getElementById('inputBauch').value = data.measurements.bauch;
                    if (data.measurements.oberschenkel) document.getElementById('inputOberschenkel').value = data.measurements.oberschenkel;
                    if (data.measurements.unterschenkel) document.getElementById('inputUnterschenkel').value = data.measurements.unterschenkel;
                    if (data.measurements.bizeps) document.getElementById('inputBizeps').value = data.measurements.bizeps;
                    if (data.measurements.brust) document.getElementById('inputBrust').value = data.measurements.brust;
                }
                
                // Mark completed habits
                if (data.habits) {
                    Object.keys(data.habits).forEach(habitId => {
                        if (data.habits[habitId]) {
                            document.getElementById(`habit-${habitId}`).classList.add('completed');
                        }
                    });
                }
            }
        }

        // Toggle habit completion
        function toggleHabit(habitId) {
            const habitCard = document.getElementById(`habit-${habitId}`);
            habitCard.classList.toggle('completed');
        }

        // Save daily data
        function saveDaily() {
            const date = document.getElementById('inputDate').value;
            const weight = parseFloat(document.getElementById('inputWeight').value);
            const journal = document.getElementById('inputJournal').value;
            
            // Collect habits
            const habits = {};
            appData.habits.forEach(habit => {
                const habitCard = document.getElementById(`habit-${habit.id}`);
                habits[habit.id] = habitCard.classList.contains('completed');
            });
            
            // Initialize daily data if not exists
            if (!appData.dailyData[date]) {
                appData.dailyData[date] = {};
            }
            
            // Save data
            appData.dailyData[date] = {
                weight: weight || appData.dailyData[date].weight,
                journal: journal,
                habits: habits
            };
            
            // Save measurements if it's measurement day
            const dayOfWeek = new Date(date).getDay();
            if (dayOfWeek === appData.settings.measurementDay) {
                appData.dailyData[date].measurements = {
                    bauch: parseFloat(document.getElementById('inputBauch').value) || null,
                    oberschenkel: parseFloat(document.getElementById('inputOberschenkel').value) || null,
                    unterschenkel: parseFloat(document.getElementById('inputUnterschenkel').value) || null,
                    bizeps: parseFloat(document.getElementById('inputBizeps').value) || null,
                    brust: parseFloat(document.getElementById('inputBrust').value) || null
                };
                
                // Update dashboard measurements
                if (appData.dailyData[date].measurements.bauch) {
                    document.getElementById('measureBauch').textContent = appData.dailyData[date].measurements.bauch + ' cm';
                }
                if (appData.dailyData[date].measurements.oberschenkel) {
                    document.getElementById('measureOberschenkel').textContent = appData.dailyData[date].measurements.oberschenkel + ' cm';
                }
                if (appData.dailyData[date].measurements.unterschenkel) {
                    document.getElementById('measureUnterschenkel').textContent = appData.dailyData[date].measurements.unterschenkel + ' cm';
                }
                if (appData.dailyData[date].measurements.bizeps) {
                    document.getElementById('measureBizeps').textContent = appData.dailyData[date].measurements.bizeps + ' cm';
                }
                if (appData.dailyData[date].measurements.brust) {
                    document.getElementById('measureBrust').textContent = appData.dailyData[date].measurements.brust + ' cm';
                }
            }
            
            // Calculate points
            let dailyPoints = 0;
            Object.values(habits).forEach(completed => {
                if (completed) dailyPoints += 10;
            });
            
            // Bonus points for weight loss
            const dates = Object.keys(appData.dailyData).sort();
            const previousDate = dates[dates.length - 2];
            if (previousDate && appData.dailyData[previousDate].weight && weight < appData.dailyData[previousDate].weight) {
                dailyPoints += 20;
            }
            
            appData.points += dailyPoints;
            
            // Save to localStorage
            saveData();
            
            // Show success message
            alert('Daten gespeichert! Du hast ' + dailyPoints + ' Punkte erhalten! üéâ');
            
            // Switch to dashboard
            switchTab('dashboard');
        }

        // Load settings
        function loadSettings() {
            document.getElementById('startWeight').value = appData.settings.startWeight;
            document.getElementById('targetWeight').value = appData.settings.targetWeight;
            document.getElementById('targetDate').value = appData.settings.targetDate;
            document.getElementById('weekStart').value = appData.settings.weekStart;
            document.getElementById('measurementDay').value = appData.settings.measurementDay;
            
            // Load habits list
            loadHabitsList();
        }

        // Load habits list in settings
        function loadHabitsList() {
            const habitsList = document.getElementById('habitsList');
            habitsList.innerHTML = appData.habits.map(habit => `
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 10px; background: #f3f4f6; border-radius: 10px; margin-bottom: 10px;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px;">${habit.icon}</span>
                        <span>${habit.name}</span>
                        <span style="font-size: 12px; color: #6b7280;">(${habit.frequency === 'daily' ? 'T√§glich' : habit.target + 'x/Woche'})</span>
                    </div>
                    <button class="btn btn-danger" onclick="deleteHabit(${habit.id})">L√∂schen</button>
                </div>
            `).join('');
        }

        // Save settings
        function saveSettings() {
            appData.settings = {
                startWeight: parseFloat(document.getElementById('startWeight').value),
                targetWeight: parseFloat(document.getElementById('targetWeight').value),
                targetDate: document.getElementById('targetDate').value,
                weekStart: parseInt(document.getElementById('weekStart').value),
                measurementDay: parseInt(document.getElementById('measurementDay').value)
            };
            
            saveData();
            alert('Einstellungen gespeichert! ‚úÖ');
            updateDashboard();
        }

        // Delete habit
        function deleteHabit(habitId) {
            if (confirm('M√∂chtest du diesen Habit wirklich l√∂schen?')) {
                appData.habits = appData.habits.filter(h => h.id !== habitId);
                saveData();
                loadHabitsList();
            }
        }

        // Show add habit dialog
        function showAddHabitDialog() {
            const name = prompt('Name des neuen Habits:');
            if (!name) return;
            
            const icon = prompt('Emoji f√ºr den Habit:', 'üéØ');
            const frequency = confirm('T√§glich? (OK = T√§glich, Abbrechen = W√∂chentlich)') ? 'daily' : 'weekly';
            
            let target = 1;
            if (frequency === 'weekly') {
                target = parseInt(prompt('Wie oft pro Woche?', '3')) || 3;
            }
            
            const newHabit = {
                id: Date.now(),
                name: name,
                icon: icon || 'üéØ',
                frequency: frequency,
                target: target,
                color: '#' + Math.floor(Math.random()*16777215).toString(16)
            };
            
            appData.habits.push(newHabit);
            saveData();
            loadInputForm();
        }

        // Initialize app
        window.onload = function() {
            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('inputDate').value = today;
            // Remove max date restriction for testing purposes
            // document.getElementById('inputDate').max = today;
            
            // Load data
            loadData();
            
            // Create initial plan
            createInitialPlan();
            
            // Display week motto
            displayWeekMotto();
        };

        // Create initial plan for weight loss
        function createInitialPlan() {
            // Check if plan already exists
            if (!appData.plan) {
                appData.plan = generateWeightLossPlan();
                saveData();
            }
        }

        // Generate weight loss plan
        function generateWeightLossPlan() {
            const startDate = new Date();
            const endDate = new Date('2025-08-08');
            const totalDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
            const totalWeightLoss = 9.1; // kg
            const dailyLoss = totalWeightLoss / totalDays;
            
            const plan = {
                phases: [
                    {
                        week: 1,
                        motto: "üöÄ Startwoche - Neue Gewohnheiten etablieren",
                        focus: "Kein Alkohol, Zuckerreduktion beginnen",
                        tips: [
                            "Trinke mindestens 3L Wasser t√§glich",
                            "Ersetze S√º√üigkeiten durch Obst",
                            "Plane deine Rennrad-Touren im Voraus"
                        ]
                    },
                    {
                        week: 2,
                        motto: "üí™ Momentum aufbauen",
                        focus: "Yoga-Routine festigen, erste Erfolge feiern",
                        tips: [
                            "Morgen-Yoga f√ºr einen energievollen Start",
                            "N√ºsse als gesunder Snack",
                            "Dokumentiere deine Fortschritte t√§glich"
                        ]
                    },
                    {
                        week: 3,
                        motto: "üî• Intensivierung",
                        focus: "L√§ngere Rennrad-Touren, Zuckerverzicht verst√§rken",
                        tips: [
                            "Erh√∂he die Rennrad-Distanz um 20%",
                            "Meal Prep f√ºr die Woche",
                            "Belohne dich mit neuer Sportkleidung"
                        ]
                    },
                    {
                        week: 4,
                        motto: "‚ö° Durchbruch",
                        focus: "Erste gro√üe Meilensteine erreichen",
                        tips: [
                            "Feiere 4 Wochen ohne Alkohol",
                            "Probiere neue Yoga-Stile aus",
                            "Plane ein gesundes Festessen"
                        ]
                    },
                    {
                        week: 5,
                        motto: "üåü Transformation",
                        focus: "Neue Identit√§t als Sportler festigen",
                        tips: [
                            "Setze dir neue Rennrad-Ziele",
                            "Teile deine Erfolge mit Freunden",
                            "Experimentiere mit neuen Gem√ºse-Rezepten"
                        ]
                    },
                    {
                        week: 6,
                        motto: "üèÜ Meisterschaft",
                        focus: "Perfektion der Routinen",
                        tips: [
                            "Tracke deine pers√∂nlichen Bestzeiten",
                            "Meditation nach dem Yoga",
                            "Plane die Zukunft nach dem Ziel"
                        ]
                    },
                    {
                        week: 7,
                        motto: "üéØ Zielgerade",
                        focus: "Letzter Sprint zum Ziel",
                        tips: [
                            "Visualisiere dein Zielgewicht t√§glich",
                            "Bereite die Zielfeier vor",
                            "Reflektiere √ºber deine Reise"
                        ]
                    },
                    {
                        week: 8,
                        motto: "üéâ Triumph!",
                        focus: "Ziel erreichen und neue Ziele setzen",
                        tips: [
                            "Feiere deinen Erfolg geb√ºhrend",
                            "Setze neue, nachhaltige Ziele",
                            "Teile deine Erfolgsgeschichte"
                        ]
                    }
                ],
                dailyRoutine: {
                    morgen: [
                        "Wiegen und tracken",
                        "Gro√ües Glas Wasser",
                        "5 Min Meditation oder Atem√ºbungen",
                        "Gesundes Fr√ºhst√ºck mit Protein"
                    ],
                    mittag: [
                        "Gem√ºsereiche Mahlzeit",
                        "30 Min Spaziergang",
                        "Wassermelone als Snack"
                    ],
                    abend: [
                        "Yoga-Session (an Yoga-Tagen)",
                        "Leichtes Abendessen",
                        "Tagebuch schreiben",
                        "Fr√ºh schlafen gehen"
                    ]
                },
                rewardSystem: {
                    10: "Neue Yoga-Matte",
                    25: "Massage",
                    50: "Neues Rennrad-Zubeh√∂r",
                    100: "Wellness-Wochenende",
                    200: "Neue Sportkleidung Shopping",
                    500: "Traumurlaub"
                }
            };
            
            return plan;
        }

        // Show current week plan
        function getCurrentWeekPlan() {
            const startDate = new Date('2025-06-12');
            const today = new Date();
            const weekNumber = Math.ceil((today - startDate) / (1000 * 60 * 60 * 24 * 7));
            
            if (appData.plan && appData.plan.phases[weekNumber - 1]) {
                return appData.plan.phases[weekNumber - 1];
            }
            return null;
        }

        // Update habit chart
        function updateHabitChart() {
            const ctx = document.getElementById('habitChart').getContext('2d');
            
            // Get last 7 days
            const days = [];
            const datasets = [];
            const today = new Date();
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                days.push(date.toISOString().split('T')[0]);
            }
            
            // Prepare data for each habit
            const colors = {
                1: 'rgba(239, 68, 68, 0.8)',   // Rennrad - red
                2: 'rgba(16, 185, 129, 0.8)',  // Yoga - green
                3: 'rgba(99, 102, 241, 0.8)',  // Kein Alkohol - indigo
                4: 'rgba(245, 158, 11, 0.8)',  // Wenig Zucker - amber
                5: 'rgba(139, 92, 246, 0.8)'   // Obst/Gem√ºse - purple
            };
            
            // Calculate completion rates for each habit
            appData.habits.forEach(habit => {
                const data = days.map(day => {
                    if (appData.dailyData[day] && appData.dailyData[day].habits) {
                        return appData.dailyData[day].habits[habit.id] ? 1 : 0;
                    }
                    return 0;
                });
                
                datasets.push({
                    label: habit.name,
                    data: data,
                    backgroundColor: colors[habit.id] || 'rgba(128, 128, 128, 0.8)',
                    borderWidth: 0,
                    barPercentage: 0.8
                });
            });
            
            if (window.habitChart) {
                window.habitChart.destroy();
            }
            
            window.habitChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: days.map(day => {
                        const date = new Date(day);
                        return date.toLocaleDateString('de-DE', { weekday: 'short', day: 'numeric' });
                    }),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + (context.parsed.y === 1 ? '‚úì' : '‚úó');
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'Tage'
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            max: appData.habits.length,
                            ticks: {
                                stepSize: 1,
                                callback: function(value) {
                                    return value + ' Habits';
                                }
                            },
                            title: {
                                display: true,
                                text: 'Erreichte Habits'
                            }
                        }
                    }
                }
            });
            
            // Create weekly statistics
            createWeeklyStats();
        }
        
        // Create weekly habit statistics
        function createWeeklyStats() {
            // Stats are now integrated into the habit chart
        }
        // Update daily habit table
        function updateDailyHabitTable() {
            const table = document.getElementById('dailyHabitTable');
            const days = [];
            const today = new Date();
            
            // Get last 7 days
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                days.push(date.toISOString().split('T')[0]);
            }
            
            // Create table header
            let html = `
                <thead>
                    <tr style="background: #f3f4f6;">
                        <th style="padding: 12px; text-align: left; font-weight: bold; border-bottom: 2px solid #e5e7eb;">Datum</th>
                        ${appData.habits.map(habit => 
                            `<th style="padding: 12px; text-align: center; border-bottom: 2px solid #e5e7eb;">
                                <div>${habit.icon}</div>
                                <div style="font-size: 12px; font-weight: normal;">${habit.name}</div>
                            </th>`
                        ).join('')}
                        <th style="padding: 12px; text-align: center; border-bottom: 2px solid #e5e7eb;">Erreicht</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            // Create rows for each day
            days.forEach((day, index) => {
                const date = new Date(day);
                const isToday = day === today.toISOString().split('T')[0];
                const dayData = appData.dailyData[day] || {};
                let completedCount = 0;
                
                html += `<tr style="background: ${index % 2 === 0 ? '#ffffff' : '#f9fafb'}; ${isToday ? 'box-shadow: 0 0 0 2px #6366f1;' : ''}">`;
                html += `<td style="padding: 12px; font-weight: ${isToday ? 'bold' : 'normal'}; color: ${isToday ? '#6366f1' : 'inherit'};">
                    ${date.toLocaleDateString('de-DE', { weekday: 'short', day: 'numeric', month: 'numeric' })}
                    ${isToday ? ' (Heute)' : ''}
                </td>`;
                
                appData.habits.forEach(habit => {
                    const completed = dayData.habits && dayData.habits[habit.id];
                    if (completed) completedCount++;
                    
                    html += `<td style="padding: 12px; text-align: center;">
                        <span style="font-size: 24px; ${completed ? 'color: #10b981;' : 'color: #e5e7eb;'}">
                            ${completed ? '‚úì' : '‚óã'}
                        </span>
                    </td>`;
                });
                
                const percentage = (completedCount / appData.habits.length * 100).toFixed(0);
                html += `<td style="padding: 12px; text-align: center; font-weight: bold;">
                    <span style="color: ${percentage >= 80 ? '#10b981' : percentage >= 50 ? '#f59e0b' : '#ef4444'};">
                        ${completedCount}/${appData.habits.length} (${percentage}%)
                    </span>
                </td>`;
                
                html += '</tr>';
            });
            
            html += '</tbody>';
            table.innerHTML = html;
        }
        
        // Update daily weight changes
        function updateDailyWeightChanges() {
            const container = document.getElementById('dailyWeightChanges');
            const days = [];
            const today = new Date();
            
            // Get last 7 days with weight data
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                if (appData.dailyData[dateStr] && appData.dailyData[dateStr].weight) {
                    days.push(dateStr);
                }
            }
            
            if (days.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6b7280;">Noch keine Gewichtsdaten vorhanden</p>';
                return;
            }
            
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px;">';
            
            days.forEach((day, index) => {
                const date = new Date(day);
                const weight = appData.dailyData[day].weight;
                let change = 0;
                let changeText = 'Start';
                let changeColor = '#6b7280';
                
                if (index > 0) {
                    const prevDay = days[index - 1];
                    const prevWeight = appData.dailyData[prevDay].weight;
                    change = weight - prevWeight;
                    changeText = (change >= 0 ? '+' : '') + change.toFixed(1) + ' kg';
                    changeColor = change <= 0 ? '#10b981' : '#ef4444';
                }
                
                const isToday = day === today.toISOString().split('T')[0];
                
                html += `
                    <div style="background: ${isToday ? 'linear-gradient(135deg, #6366f1, #4f46e5)' : '#f9fafb'}; 
                                color: ${isToday ? 'white' : 'inherit'}; 
                                border-radius: 10px; 
                                padding: 15px; 
                                text-align: center;
                                box-shadow: ${isToday ? '0 5px 15px rgba(99, 102, 241, 0.3)' : 'none'};">
                        <div style="font-size: 12px; ${isToday ? 'opacity: 0.9;' : 'color: #6b7280;'}">
                            ${date.toLocaleDateString('de-DE', { weekday: 'short', day: 'numeric' })}
                            ${isToday ? ' (Heute)' : ''}
                        </div>
                        <div style="font-size: 24px; font-weight: bold; margin: 5px 0;">
                            ${weight} kg
                        </div>
                        <div style="font-size: 14px; font-weight: bold; color: ${isToday ? 'white' : changeColor};">
                            ${changeText}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            // Add weekly summary
            if (days.length > 1) {
                const firstWeight = appData.dailyData[days[0]].weight;
                const lastWeight = appData.dailyData[days[days.length - 1]].weight;
                const weekChange = lastWeight - firstWeight;
                const avgDailyChange = weekChange / days.length;
                
                html += `
                    <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #f3f4f6, white); border-radius: 10px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; text-align: center;">
                            <div>
                                <div style="font-size: 14px; color: #6b7280;">Wochenver√§nderung</div>
                                <div style="font-size: 20px; font-weight: bold; color: ${weekChange <= 0 ? '#10b981' : '#ef4444'};">
                                    ${weekChange >= 0 ? '+' : ''}${weekChange.toFixed(1)} kg
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 14px; color: #6b7280;">√ò pro Tag</div>
                                <div style="font-size: 20px; font-weight: bold; color: ${avgDailyChange <= 0 ? '#10b981' : '#ef4444'};">
                                    ${avgDailyChange >= 0 ? '+' : ''}${avgDailyChange.toFixed(2)} kg
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 14px; color: #6b7280;">Trend</div>
                                <div style="font-size: 20px;">
                                    ${weekChange <= -0.5 ? 'üìâ Sehr gut!' : weekChange <= 0 ? '‚û°Ô∏è Stabil' : 'üìà Achtung!'}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        // Add week motto to dashboard
        function displayWeekMotto() {
            const weekPlan = getCurrentWeekPlan();
            if (weekPlan && document.getElementById('dashboard')) {
                const existingMotto = document.getElementById('weekMotto');
                if (existingMotto) existingMotto.remove();
                
                const mottoDiv = document.createElement('div');
                mottoDiv.id = 'weekMotto';
                mottoDiv.style.cssText = 'background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: center;';
                mottoDiv.innerHTML = `
                    <h3 style="margin-bottom: 10px;">Woche ${weekPlan.week}: ${weekPlan.motto}</h3>
                    <p style="font-size: 14px; opacity: 0.9;">${weekPlan.focus}</p>
                `;
                
                const dashboard = document.getElementById('dashboard');
                const rewardsContainer = dashboard.querySelector('.rewards-container');
                dashboard.insertBefore(mottoDiv, rewardsContainer);
            }
        }
    </script>
</body>
</html>
