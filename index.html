<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health-Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #CFD6D5 0%, #86B9B1 100%);
            min-height: 100vh;
            padding: 20px;
            color: #26343E;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        /* Header Styles */
        .header-container {
            width: 100%;
            background: linear-gradient(45deg, #042630 0%, #26343E 100%);
            padding: 30px 20px;
            border-radius: 15px 15px 0 0;
            box-shadow: 0 4px 20px rgba(4, 38, 48, 0.3);
        }

        .header-title {
            font-size: 40px;
            font-weight: bold;
            text-align: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .pill-button {
            background: rgba(134, 185, 177, 0.2);
            border: 2px solid rgba(134, 185, 177, 0.4);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .pill-button:hover {
            background: rgba(75, 114, 114, 0.8);
            border-color: #4B7272;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(75, 114, 114, 0.3);
        }

        .pill-button.active {
            background: #86B9B1;
            color: #042630;
            border-color: #86B9B1;
            box-shadow: 0 4px 15px rgba(134, 185, 177, 0.4);
        }

        /* Content Sections */
        .content-section {
            display: none;
            padding: 30px;
        }

        .content-section.active {
            display: block;
        }

        /* Dashboard Grid */
        .cards-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .cards-section-full {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            width: 100%;
        }

        .card {
            background: linear-gradient(145deg, #CFD6D5, #ffffff);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(4, 38, 48, 0.1);
            border: 1px solid rgba(134, 185, 177, 0.2);
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: 0 12px 35px rgba(4, 38, 48, 0.15);
            transform: translateY(-2px);
        }

        .card h3 {
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            color: #2c5f5f;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4a9999;
        }

        .card-content {
            line-height: 1.6;
        }

        .card-content div {
            margin: 8px 0;
            padding: 5px 0;
        }

        .label {
            font-weight: 600;
            color: #555;
        }

        .value {
            color: #4a9999;
            font-weight: bold;
        }

        /* Progress Bar */
        .progress-container {
            margin: 15px 0;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #CFD6D5;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid rgba(134, 185, 177, 0.3);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #86B9B1, #4B7272);
            transition: width 0.5s ease;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(134, 185, 177, 0.3);
        }

        .progress-text {
            text-align: center;
            margin-top: 5px;
            font-weight: bold;
            color: #4B7272;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #042630;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #CFD6D5;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            color: #26343E;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #86B9B1;
            box-shadow: 0 0 0 3px rgba(134, 185, 177, 0.1);
            background: white;
        }

        .btn-primary {
            background: linear-gradient(45deg, #86B9B1 0%, #4B7272 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(134, 185, 177, 0.3);
            text-shadow: 0 1px 2px rgba(4, 38, 48, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(45deg, #4B7272 0%, #042630 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(75, 114, 114, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(75, 114, 114, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #4B7272 0%, #26343E 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(75, 114, 114, 0.2);
        }

        .btn-secondary:hover {
            background: linear-gradient(45deg, #042630 0%, #26343E 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(4, 38, 48, 0.3);
        }

        .btn-secondary:active {
            transform: translateY(0);
            box-shadow: 0 1px 4px rgba(4, 38, 48, 0.2);
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.2);
        }

        .btn-danger:hover {
            background: linear-gradient(45deg, #c82333 0%, #a71e2a 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }

        .btn-danger:active {
            transform: translateY(0);
            box-shadow: 0 1px 4px rgba(220, 53, 69, 0.2);
        }

        /* Lists */
        .list-item {
            background: #f0f9f9;
            border: 1px solid #b8dede;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .list-content {
            flex-grow: 1;
        }

        .list-actions {
            display: flex;
            gap: 10px;
        }

        /* Weight entries table */
        .weight-table,
        .habits-settings-table,
        .habits-week-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .weight-table th,
        .weight-table td,
        .habits-settings-table th,
        .habits-settings-table td,
        .habits-week-table th,
        .habits-week-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #b8dede;
            border-right: 1px solid #b8dede;
        }

        .weight-table th,
        .habits-settings-table th,
        .habits-week-table th {
            background: #e8f5f5;
            font-weight: 600;
            text-align: center;
        }

        .habits-week-table td {
            text-align: center;
            vertical-align: middle;
        }

        .habits-week-table td.habit-name {
            text-align: left;
            font-weight: 600;
            background: #f0f9f9;
        }

        .habits-settings-item {
            background: linear-gradient(145deg, #CFD6D5, rgba(255, 255, 255, 0.9));
            border: 1px solid rgba(134, 185, 177, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(4, 38, 48, 0.05);
        }

        .habits-settings-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(4, 38, 48, 0.1);
        }

        .habit-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #86B9B1;
            border-radius: 4px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .habit-checkbox.checked {
            background: linear-gradient(45deg, #86B9B1, #4B7272);
            color: white;
            border-color: #4B7272;
            box-shadow: 0 2px 8px rgba(134, 185, 177, 0.4);
        }

        .habit-checkbox:hover {
            background: rgba(134, 185, 177, 0.2);
            border-color: #4B7272;
            transform: scale(1.1);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .cards-section {
                grid-template-columns: 1fr;
            }
            
            .nav-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .header-title {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header-container">
            <h1 class="header-title">Health-Tracker</h1>
            <div class="nav-buttons">
                <button class="pill-button active" onclick="showSection('dashboard')">Dashboard</button>
                <button class="pill-button" onclick="showSection('eingabe')">Eingabe</button>
                <button class="pill-button" onclick="showSection('tagebuch')">Tagebuch</button>
                <button class="pill-button" onclick="showSection('einstellung')">Einstellung</button>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard" class="content-section active">
            <!-- Karten-Section 1: Original 3-Spalten Grid -->
            <div class="cards-section">
                <!-- Karte 1: Fastenzeitraum -->
                <div class="card">
                    <h3>Fastenzeitraum</h3>
                    <div class="card-content">
                        <div><span class="label">Startdatum:</span> <span class="value" id="fast-start">-</span></div>
                        <div><span class="label">Zieldatum:</span> <span class="value" id="fast-end">-</span></div>
                        <div><span class="label">Verbleibende Wochen:</span> <span class="value" id="weeks-left">-</span></div>
                        <div><span class="label">Verbleibende Tage:</span> <span class="value" id="days-left">-</span></div>
                    </div>
                </div>

                <!-- Karte 2: Gewichtsziel -->
                <div class="card">
                    <h3>Gewichtsziel</h3>
                    <div class="card-content">
                        <div><span class="label">Startgewicht:</span> <span class="value" id="start-weight">-</span></div>
                        <div><span class="label">Zielgewicht:</span> <span class="value" id="target-weight">-</span></div>
                        <div><span class="label">Gesamtabnahme:</span> <span class="value" id="total-loss">-</span></div>
                        <div><span class="label">Ø pro Woche:</span> <span class="value" id="avg-week">-</span></div>
                        <div><span class="label">Ø pro Tag:</span> <span class="value" id="avg-day">-</span></div>
                    </div>
                </div>

                <!-- Karte 3: Fortschritt -->
                <div class="card">
                    <h3>Fortschritt</h3>
                    <div class="card-content">
                        <div><span class="label">Aktuelles Gewicht:</span> <span class="value" id="current-weight">-</span></div>
                        <div><span class="label">Erreicht:</span> <span class="value" id="progress-percent">-</span></div>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                            </div>
                            <div class="progress-text" id="progress-text">0%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Karten-Section 2: Gewichtsverlauf Diagramm (1 Spalte, 100% Breite) -->
            <div class="cards-section-full" style="margin-top: 30px;">
                <div class="card">
                    <h3 style="text-align: left;">Gewichtsverlauf</h3>
                    <div class="card-content">
                        <div id="weight-chart-container">
                            <svg id="weight-chart" width="100%" height="300" style="border: 1px solid #e8f5f5; border-radius: 8px;">
                                <!-- Chart will be generated by JavaScript -->
                            </svg>
                            <div class="chart-legend" style="margin-top: 15px; display: flex; justify-content: center; gap: 20px;">
                                <div style="display: flex; align-items: center;">
                                    <div style="width: 20px; height: 3px; background: #dc3545; margin-right: 5px;"></div>
                                    <span>Startgewicht</span>
                                </div>
                                <div style="display: flex; align-items: center;">
                                    <div style="width: 20px; height: 3px; background: #28a745; margin-right: 5px;"></div>
                                    <span>Zielgewicht</span>
                                </div>
                                <div style="display: flex; align-items: center;">
                                    <div style="width: 20px; height: 3px; background: #4a9999; margin-right: 5px;"></div>
                                    <span>Tägliches Gewicht</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Karten-Section 3: Gewohnheiten Wochenübersicht (1 Spalte, 100% Breite) -->
            <div class="cards-section-full" style="margin-top: 30px;">
                <div class="card">
                    <h3 style="text-align: left;">Gewohnheiten</h3>
                    <div class="card-content">
                        <div id="habits-week-table-container">
                            <!-- Wird dynamisch generiert -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Eingabe Section -->
        <div id="eingabe" class="content-section">
            <!-- Karten-Section 1: Gewichtseingabe -->
            <div class="cards-section-full">
                <div class="card">
                    <h3 style="text-align: left;">Gewicht eingeben</h3>
                    <div class="card-content">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; align-items: end;">
                            <div class="form-group">
                                <label for="weight-date">Datum:</label>
                                <input type="date" id="weight-date">
                            </div>
                            <div class="form-group">
                                <label for="weight-value">Gewicht (kg):</label>
                                <input type="number" step="0.1" id="weight-value" placeholder="z.B. 75.5">
                            </div>
                            <div>
                                <button class="btn-primary" onclick="addWeight()">Gewicht hinzufügen</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Karten-Section 2: Gewichtseinträge anzeigen -->
            <div class="cards-section-full" style="margin-top: 30px;">
                <div class="card">
                    <h3 style="text-align: left;">Gewichtseinträge</h3>
                    <div class="card-content">
                        <table class="weight-table">
                            <thead>
                                <tr>
                                    <th>Datum</th>
                                    <th>Gewicht (kg)</th>
                                    <th>Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="weight-entries">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Karten-Section 3: Gewohnheitseingabe -->
            <div class="cards-section-full" style="margin-top: 30px;">
                <div class="card">
                    <h3 style="text-align: left;">Gewohnheit hinzufügen</h3>
                    <div class="card-content">
                        <div style="display: grid; grid-template-columns: 2fr 1fr auto; gap: 20px; align-items: end;">
                            <div class="form-group">
                                <label for="habit-name">Gewohnheit:</label>
                                <input type="text" id="habit-name" placeholder="z.B. 10.000 Schritte gehen">
                            </div>
                            <div class="form-group">
                                <label for="habit-frequency">Häufigkeit:</label>
                                <select id="habit-frequency">
                                    <option value="täglich">Täglich</option>
                                    <option value="wöchentlich">Wöchentlich</option>
                                </select>
                            </div>
                            <div>
                                <button class="btn-primary" onclick="addHabit()">Gewohnheit hinzufügen</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Karten-Section 4: Gewohnheiten anzeigen -->
            <div class="cards-section-full" style="margin-top: 30px;">
                <div class="card">
                    <h3 style="text-align: left;">Meine Gewohnheiten</h3>
                    <div class="card-content">
                        <div id="habits-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tagebuch Section -->
        <div id="tagebuch" class="content-section">
            <!-- Karten-Section 1: Neuer Tagebucheintrag -->
            <div class="cards-section-full">
                <div class="card">
                    <h3 style="text-align: left;">Neuer Tagebucheintrag</h3>
                    <div class="card-content">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                            <div class="form-group">
                                <label for="diary-date">Datum:</label>
                                <input type="date" id="diary-date">
                            </div>
                            <div class="form-group">
                                <label for="diary-title">Titel:</label>
                                <input type="text" id="diary-title" placeholder="Titel für den Eintrag">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="diary-content">Inhalt:</label>
                            <textarea id="diary-content" rows="5" placeholder="Wie war Ihr Tag? Notizen, Erfolge, Herausforderungen..."></textarea>
                        </div>
                        <div style="margin-top: 20px;">
                            <button class="btn-primary" onclick="addDiaryEntry()">Eintrag speichern</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Karten-Section 2: Tagebucheinträge anzeigen -->
            <div class="cards-section-full" style="margin-top: 30px;">
                <div class="card">
                    <h3 style="text-align: left;">Meine Tagebucheinträge</h3>
                    <div class="card-content">
                        <div id="diary-entries"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Einstellung Section -->
        <div id="einstellung" class="content-section">
            <!-- Karten-Section 1: Grundeinstellungen -->
            <div class="cards-section-full">
                <div class="card">
                    <h3 style="text-align: left;">Grundeinstellungen</h3>
                    <div class="card-content">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div class="form-group">
                                <label for="settings-start-weight">Startgewicht (kg):</label>
                                <input type="number" step="0.1" id="settings-start-weight" placeholder="z.B. 80.0">
                            </div>
                            
                            <div class="form-group">
                                <label for="settings-target-weight">Zielgewicht (kg):</label>
                                <input type="number" step="0.1" id="settings-target-weight" placeholder="z.B. 70.0">
                            </div>
                            
                            <div class="form-group">
                                <label for="settings-fast-start">Startdatum:</label>
                                <input type="date" id="settings-fast-start">
                            </div>
                            
                            <div class="form-group">
                                <label for="settings-fast-end">Zieldatum:</label>
                                <input type="date" id="settings-fast-end">
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <button class="btn-primary" onclick="saveSettings()">Einstellungen speichern</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Karten-Section 2: Gewohnheiten verwalten -->
            <div class="cards-section-full" style="margin-top: 30px;">
                <div class="card">
                    <h3 style="text-align: left;">Gewohnheiten verwalten</h3>
                    <div class="card-content">
                        <!-- Gewohnheit hinzufügen -->
                        <div style="display: grid; grid-template-columns: 2fr 1fr auto; gap: 15px; align-items: end; margin-bottom: 30px;">
                            <div class="form-group">
                                <label for="habit-name-settings">Gewohnheit:</label>
                                <input type="text" id="habit-name-settings" placeholder="z.B. Joggen, Meditation, etc.">
                            </div>
                            <div class="form-group">
                                <label for="habit-frequency-settings">Häufigkeit pro Woche:</label>
                                <input type="number" min="1" max="7" id="habit-frequency-settings" placeholder="z.B. 3">
                            </div>
                            <div>
                                <button class="btn-primary" onclick="addHabitFromSettings()">Gewohnheit hinzufügen</button>
                            </div>
                        </div>

                        <!-- Ihre Gewohnheiten -->
                        <div>
                            <h4 style="margin-bottom: 15px; color: #2c5f5f;">Ihre Gewohnheiten</h4>
                            <div id="habits-settings-table">
                                <!-- Wird dynamisch gefüllt -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage (in memory during session)
        let appData = {
            settings: {
                fastStart: '',
                fastEnd: '',
                startWeight: 0,
                targetWeight: 0
            },
            weights: [],
            habits: [],
            diaryEntries: []
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('weight-date').value = today;
            document.getElementById('diary-date').value = today;
            
            updateDashboard();
            updateWeightTable();
            updateHabitsDisplay();
            updateDiaryDisplay();
            updateHabitsSettingsDisplay();
            updateHabitsWeekTable();
            drawWeightChart();
        });

        // Navigation
        function showSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => section.classList.remove('active'));
            
            // Show selected section
            document.getElementById(sectionName).classList.add('active');
            
            // Update button states
            const buttons = document.querySelectorAll('.pill-button');
            buttons.forEach(button => button.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update dashboard if switching to it
            if (sectionName === 'dashboard') {
                updateDashboard();
            }
        }

        // Settings
        function saveSettings() {
            appData.settings.fastStart = document.getElementById('settings-fast-start').value;
            appData.settings.fastEnd = document.getElementById('settings-fast-end').value;
            appData.settings.startWeight = parseFloat(document.getElementById('settings-start-weight').value) || 0;
            appData.settings.targetWeight = parseFloat(document.getElementById('settings-target-weight').value) || 0;
            
            alert('Einstellungen gespeichert!');
            updateDashboard();
        }

        // Weight management
        function addWeight() {
            const date = document.getElementById('weight-date').value;
            const weight = parseFloat(document.getElementById('weight-value').value);
            
            if (!date || !weight) {
                alert('Bitte Datum und Gewicht eingeben!');
                return;
            }
            
            // Check if entry for this date already exists
            const existingIndex = appData.weights.findIndex(entry => entry.date === date);
            if (existingIndex !== -1) {
                appData.weights[existingIndex].weight = weight;
            } else {
                appData.weights.push({ date, weight });
            }
            
            // Sort by date
            appData.weights.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            document.getElementById('weight-value').value = '';
            updateWeightTable();
            updateDashboard();
        }

        function editWeight(index) {
            const entry = appData.weights[index];
            const newWeight = prompt('Neues Gewicht:', entry.weight);
            if (newWeight !== null && !isNaN(parseFloat(newWeight))) {
                appData.weights[index].weight = parseFloat(newWeight);
                updateWeightTable();
                updateDashboard();
            }
        }

        function deleteWeight(index) {
            if (confirm('Gewichtseintrag löschen?')) {
                appData.weights.splice(index, 1);
                updateWeightTable();
                updateDashboard();
            }
        }

        function updateWeightTable() {
            const tbody = document.getElementById('weight-entries');
            tbody.innerHTML = '';
            
            if (appData.weights.length === 0) {
                const row = tbody.insertRow();
                row.innerHTML = '<td colspan="3" style="text-align: center; color: #666; font-style: italic; padding: 20px;">Noch keine Gewichtseinträge vorhanden.</td>';
                return;
            }
            
            appData.weights.forEach((entry, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${new Date(entry.date).toLocaleDateString('de-DE')}</td>
                    <td>${entry.weight} kg</td>
                    <td>
                        <button class="btn-secondary" onclick="editWeight(${index})">Bearbeiten</button>
                        <button class="btn-danger" onclick="deleteWeight(${index})">Löschen</button>
                    </td>
                `;
            });
        }

        // Habits management
        function addHabit() {
            const name = document.getElementById('habit-name').value;
            const frequency = document.getElementById('habit-frequency').value;
            
            if (!name) {
                alert('Bitte Gewohnheit eingeben!');
                return;
            }
            
            // Convert old frequency format to weekly count
            let weeklyCount = frequency === 'täglich' ? 7 : 1;
            
            appData.habits.push({ name, frequency, weeklyCount });
            document.getElementById('habit-name').value = '';
            updateHabitsDisplay();
            updateHabitsSettingsDisplay();
        }

        function addHabitFromSettings() {
            const name = document.getElementById('habit-name-settings').value;
            const weeklyCount = parseInt(document.getElementById('habit-frequency-settings').value) || 1;
            
            if (!name) {
                alert('Bitte Gewohnheit eingeben!');
                return;
            }
            
            // Create frequency text for display
            const frequency = weeklyCount === 7 ? 'täglich' : `${weeklyCount}x/Woche`;
            
            appData.habits.push({ name, frequency, weeklyCount });
            document.getElementById('habit-name-settings').value = '';
            document.getElementById('habit-frequency-settings').value = '';
            updateHabitsDisplay();
            updateHabitsSettingsDisplay();
            updateHabitsWeekTable();
        }

        // Habits management
        function addHabit() {
            const name = document.getElementById('habit-name').value;
            const frequency = document.getElementById('habit-frequency').value;
            
            if (!name) {
                alert('Bitte Gewohnheit eingeben!');
                return;
            }
            
            // Convert old frequency format to weekly count
            let weeklyCount = frequency === 'täglich' ? 7 : 1;
            
            appData.habits.push({ name, frequency, weeklyCount });
            document.getElementById('habit-name').value = '';
            updateHabitsDisplay();
            updateHabitsSettingsDisplay();
            updateHabitsWeekTable();
        }

        function editHabit(index) {
            const habit = appData.habits[index];
            const newName = prompt('Gewohnheit bearbeiten:', habit.name);
            if (newName !== null && newName.trim() !== '') {
                appData.habits[index].name = newName.trim();
                updateHabitsDisplay();
                updateHabitsSettingsDisplay();
                updateHabitsWeekTable();
            }
        }

        function deleteHabit(index) {
            if (confirm('Gewohnheit löschen?')) {
                appData.habits.splice(index, 1);
                updateHabitsDisplay();
                updateHabitsSettingsDisplay();
                updateHabitsWeekTable();
            }
        }

        function updateHabitsDisplay() {
            const container = document.getElementById('habits-list');
            container.innerHTML = '';
            
            if (appData.habits.length === 0) {
                container.innerHTML = '<p style="color: #666; font-style: italic; text-align: center; padding: 20px;">Noch keine Gewohnheiten hinzugefügt.</p>';
                return;
            }
            
            appData.habits.forEach((habit, index) => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <div class="list-content">
                        <strong>${habit.name}</strong> <em>(${habit.frequency})</em>
                    </div>
                    <div class="list-actions">
                        <button class="btn-secondary" onclick="editHabit(${index})">Bearbeiten</button>
                        <button class="btn-danger" onclick="deleteHabit(${index})">Löschen</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function updateHabitsSettingsDisplay() {
            const container = document.getElementById('habits-settings-table');
            container.innerHTML = '';
            
            if (appData.habits.length === 0) {
                container.innerHTML = '<p style="color: #666; font-style: italic;">Noch keine Gewohnheiten hinzugefügt.</p>';
                return;
            }
            
            appData.habits.forEach((habit, index) => {
                const div = document.createElement('div');
                div.className = 'habits-settings-item';
                div.innerHTML = `
                    <div class="list-content">
                        <strong>${habit.name}</strong> <em>(${habit.frequency})</em>
                    </div>
                    <div class="list-actions">
                        <button class="btn-secondary" onclick="editHabitFromSettings(${index})">Bearbeiten</button>
                        <button class="btn-danger" onclick="deleteHabitFromSettings(${index})">Löschen</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function editHabitFromSettings(index) {
            const habit = appData.habits[index];
            const newName = prompt('Gewohnheit bearbeiten:', habit.name);
            if (newName !== null && newName.trim() !== '') {
                const newWeeklyCount = prompt('Häufigkeit pro Woche (1-7):', habit.weeklyCount);
                if (newWeeklyCount !== null && !isNaN(parseInt(newWeeklyCount))) {
                    const weeklyCount = Math.max(1, Math.min(7, parseInt(newWeeklyCount)));
                    const frequency = weeklyCount === 7 ? 'täglich' : `${weeklyCount}x/Woche`;
                    
                    appData.habits[index].name = newName.trim();
                    appData.habits[index].frequency = frequency;
                    appData.habits[index].weeklyCount = weeklyCount;
                    updateHabitsDisplay();
                    updateHabitsSettingsDisplay();
                    updateHabitsWeekTable();
                }
            }
        }

        function deleteHabitFromSettings(index) {
            if (confirm('Gewohnheit löschen?')) {
                appData.habits.splice(index, 1);
                updateHabitsDisplay();
                updateHabitsSettingsDisplay();
                updateHabitsWeekTable();
            }
        }

        // Diary management
        function addDiaryEntry() {
            const date = document.getElementById('diary-date').value;
            const title = document.getElementById('diary-title').value;
            const content = document.getElementById('diary-content').value;
            
            if (!date || !title || !content) {
                alert('Bitte alle Felder ausfüllen!');
                return;
            }
            
            appData.diaryEntries.push({ date, title, content });
            appData.diaryEntries.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            document.getElementById('diary-title').value = '';
            document.getElementById('diary-content').value = '';
            updateDiaryDisplay();
        }

        function editDiaryEntry(index) {
            const entry = appData.diaryEntries[index];
            const newTitle = prompt('Titel bearbeiten:', entry.title);
            if (newTitle !== null && newTitle.trim() !== '') {
                const newContent = prompt('Inhalt bearbeiten:', entry.content);
                if (newContent !== null) {
                    appData.diaryEntries[index].title = newTitle.trim();
                    appData.diaryEntries[index].content = newContent;
                    updateDiaryDisplay();
                }
            }
        }

        function deleteDiaryEntry(index) {
            if (confirm('Tagebucheintrag löschen?')) {
                appData.diaryEntries.splice(index, 1);
                updateDiaryDisplay();
            }
        }

        function updateDiaryDisplay() {
            const container = document.getElementById('diary-entries');
            container.innerHTML = '';
            
            if (appData.diaryEntries.length === 0) {
                container.innerHTML = '<p style="color: #666; font-style: italic; text-align: center; padding: 20px;">Noch keine Tagebucheinträge vorhanden.</p>';
                return;
            }
            
            appData.diaryEntries.forEach((entry, index) => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.style.flexDirection = 'column';
                div.style.alignItems = 'flex-start';
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; width: 100%; margin-bottom: 10px;">
                        <div>
                            <strong>${entry.title}</strong>
                            <em style="margin-left: 10px;">${new Date(entry.date).toLocaleDateString('de-DE')}</em>
                        </div>
                        <div class="list-actions">
                            <button class="btn-secondary" onclick="editDiaryEntry(${index})">Bearbeiten</button>
                            <button class="btn-danger" onclick="deleteDiaryEntry(${index})">Löschen</button>
                        </div>
                    </div>
                    <div style="width: 100%;">${entry.content}</div>
                `;
                container.appendChild(div);
            });
        }

        // Dashboard calculations
        function updateDashboard() {
            const settings = appData.settings;
            
            // Update Fastenzeitraum
            if (settings.fastStart && settings.fastEnd) {
                const startDate = new Date(settings.fastStart);
                const endDate = new Date(settings.fastEnd);
                const today = new Date();
                
                document.getElementById('fast-start').textContent = startDate.toLocaleDateString('de-DE');
                document.getElementById('fast-end').textContent = endDate.toLocaleDateString('de-DE');
                
                const timeDiff = endDate - today;
                const daysLeft = Math.max(0, Math.ceil(timeDiff / (1000 * 60 * 60 * 24)));
                const weeksLeft = Math.max(0, Math.floor(daysLeft / 7));
                
                document.getElementById('weeks-left').textContent = weeksLeft;
                document.getElementById('days-left').textContent = daysLeft;
            }
            
            // Update Gewichtsziel
            if (settings.startWeight && settings.targetWeight) {
                document.getElementById('start-weight').textContent = settings.startWeight + ' kg';
                document.getElementById('target-weight').textContent = settings.targetWeight + ' kg';
                
                const totalLoss = settings.startWeight - settings.targetWeight;
                document.getElementById('total-loss').textContent = totalLoss.toFixed(1) + ' kg';
                
                if (settings.fastStart && settings.fastEnd) {
                    const startDate = new Date(settings.fastStart);
                    const endDate = new Date(settings.fastEnd);
                    const totalDays = (endDate - startDate) / (1000 * 60 * 60 * 24);
                    const totalWeeks = totalDays / 7;
                    
                    const avgWeek = (totalLoss / totalWeeks).toFixed(2);
                    const avgDay = (totalLoss / totalDays).toFixed(3);
                    
                    document.getElementById('avg-week').textContent = avgWeek + ' kg';
                    document.getElementById('avg-day').textContent = avgDay + ' kg';
                }
            }
            
            // Update Fortschritt
            const currentWeight = getCurrentWeight();
            if (currentWeight && settings.startWeight && settings.targetWeight) {
                document.getElementById('current-weight').textContent = currentWeight + ' kg';
                
                const totalLoss = settings.startWeight - settings.targetWeight;
                const currentLoss = settings.startWeight - currentWeight;
                const progressPercent = Math.max(0, Math.min(100, (currentLoss / totalLoss) * 100));
                
                document.getElementById('progress-percent').textContent = progressPercent.toFixed(1) + '%';
                document.getElementById('progress-fill').style.width = progressPercent + '%';
                document.getElementById('progress-text').textContent = progressPercent.toFixed(1) + '%';
            }
            
            // Update weight chart
            drawWeightChart();
            
            // Update habits tracker
            updateHabitsTracker();
        }

        function getCurrentWeight() {
            if (appData.weights.length === 0) return null;
            return appData.weights[0].weight; // Latest weight (already sorted)
        }

        // Weight chart
        function drawWeightChart() {
            const settings = appData.settings;
            if (!settings.startWeight || !settings.targetWeight) {
                const svg = document.getElementById('weight-chart');
                svg.innerHTML = '<text x="50%" y="50%" text-anchor="middle" fill="#666" font-size="16">Bitte Grundeinstellungen konfigurieren</text>';
                return;
            }

            const svg = document.getElementById('weight-chart');
            const svgRect = svg.getBoundingClientRect();
            const width = svgRect.width || 800;
            const height = 300;
            
            // Update SVG size
            svg.setAttribute('width', width);
            svg.setAttribute('height', height);
            
            // Clear previous content
            svg.innerHTML = '';
            
            // Get weight data for chart (last 14 days)
            const chartDates = [];
            const today = new Date();
            
            for (let i = 13; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                chartDates.push(date.toISOString().split('T')[0]);
            }
            
            // Chart dimensions
            const margin = { top: 20, right: 20, bottom: 60, left: 60 };
            const chartWidth = width - margin.left - margin.right;
            const chartHeight = height - margin.top - margin.bottom;
            
            // Weight range for Y-axis
            const minWeight = Math.min(settings.targetWeight - 2, settings.startWeight - 5);
            const maxWeight = Math.max(settings.startWeight + 2, settings.targetWeight + 5);
            const weightRange = maxWeight - minWeight;
            
            // Helper functions
            function getX(dayIndex) {
                return margin.left + (dayIndex * chartWidth / (chartDates.length - 1));
            }
            
            function getY(weight) {
                return margin.top + chartHeight - ((weight - minWeight) / weightRange * chartHeight);
            }
            
            // Draw grid lines (vertical)
            for (let i = 0; i < chartDates.length; i += 2) {
                const x = getX(i);
                svg.innerHTML += `<line x1="${x}" y1="${margin.top}" x2="${x}" y2="${height - margin.bottom}" stroke="#e8f5f5" stroke-width="1"/>`;
            }
            
            // Draw Y-axis grid
            for (let i = 0; i <= 5; i++) {
                const weight = minWeight + (weightRange / 5 * i);
                const y = getY(weight);
                svg.innerHTML += `<line x1="${margin.left}" y1="${y}" x2="${width - margin.right}" y2="${y}" stroke="#e8f5f5" stroke-width="1"/>`;
                svg.innerHTML += `<text x="${margin.left - 10}" y="${y + 4}" text-anchor="end" font-size="12" fill="#666">${weight.toFixed(1)}</text>`;
            }
            
            // Draw axes
            svg.innerHTML += `<line x1="${margin.left}" y1="${margin.top}" x2="${margin.left}" y2="${height - margin.bottom}" stroke="#333" stroke-width="2"/>`;
            svg.innerHTML += `<line x1="${margin.left}" y1="${height - margin.bottom}" x2="${width - margin.right}" y2="${height - margin.bottom}" stroke="#333" stroke-width="2"/>`;
            
            // X-axis labels (dates)
            chartDates.forEach((date, i) => {
                if (i % 2 === 0) { // Show every second date to avoid crowding
                    const x = getX(i);
                    const dateObj = new Date(date);
                    svg.innerHTML += `<text x="${x}" y="${height - margin.bottom + 20}" text-anchor="middle" font-size="10" fill="#666">${dateObj.getDate()}.${dateObj.getMonth() + 1}</text>`;
                }
            });
            
            // Y-axis label
            svg.innerHTML += `<text x="20" y="${height/2}" text-anchor="middle" transform="rotate(-90 20 ${height/2})" font-size="12" fill="#666">Gewicht (kg)</text>`;
            
            // Draw target weight line (green)
            const targetY = getY(settings.targetWeight);
            svg.innerHTML += `<line x1="${margin.left}" y1="${targetY}" x2="${width - margin.right}" y2="${targetY}" stroke="#28a745" stroke-width="3" stroke-dasharray="5,5"/>`;
            
            // Draw start weight line (red)
            const startY = getY(settings.startWeight);
            svg.innerHTML += `<line x1="${margin.left}" y1="${startY}" x2="${width - margin.right}" y2="${startY}" stroke="#dc3545" stroke-width="3" stroke-dasharray="5,5"/>`;
            
            // Draw actual weight data (blue line)
            const actualWeights = chartDates.map(date => {
                const entry = appData.weights.find(w => w.date === date);
                return entry ? entry.weight : null;
            });
            
            let pathData = '';
            let hasData = false;
            
            actualWeights.forEach((weight, i) => {
                if (weight !== null) {
                    const x = getX(i);
                    const y = getY(weight);
                    
                    if (!hasData) {
                        pathData += `M ${x} ${y}`;
                        hasData = true;
                    } else {
                        pathData += ` L ${x} ${y}`;
                    }
                    
                    // Draw data point
                    svg.innerHTML += `<circle cx="${x}" cy="${y}" r="4" fill="#4a9999" stroke="white" stroke-width="2"/>`;
                }
            });
            
            // Draw the line if we have data
            if (hasData && pathData) {
                svg.innerHTML += `<path d="${pathData}" stroke="#4a9999" stroke-width="3" fill="none"/>`;
            }
        }
        function updateHabitsWeekTable() {
            const container = document.getElementById('habits-week-table-container');
            
            if (appData.habits.length === 0) {
                container.innerHTML = '<p style="color: #666; font-style: italic; text-align: center; padding: 20px;">Noch keine Gewohnheiten definiert. Gehen Sie zu "Einstellungen" um Gewohnheiten hinzuzufügen.</p>';
                return;
            }
            
            // Get current week dates
            const today = new Date();
            const currentWeekDates = [];
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay() + 1); // Monday
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(startOfWeek);
                date.setDate(startOfWeek.getDate() + i);
                currentWeekDates.push(date);
            }
            
            // Create table
            let tableHtml = '<table class="habits-week-table">';
            
            // Header row
            tableHtml += '<thead><tr><th style="text-align: left;">Gewohnheit</th>';
            const weekdays = ['Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag', 'Sonntag'];
            currentWeekDates.forEach((date, index) => {
                const dayNum = date.getDate();
                const month = date.getMonth() + 1;
                tableHtml += `<th>${weekdays[index]}<br><small>${dayNum}.${month}</small></th>`;
            });
            tableHtml += '</tr></thead>';
            
            // Body rows - one for each habit
            tableHtml += '<tbody>';
            appData.habits.forEach((habit, habitIndex) => {
                tableHtml += '<tr>';
                tableHtml += `<td class="habit-name">${habit.name}<br><small style="color: #666;">(${habit.frequency})</small></td>`;
                
                currentWeekDates.forEach((date, dayIndex) => {
                    const dateString = date.toISOString().split('T')[0];
                    const isChecked = isHabitChecked(habitIndex, dateString);
                    const checkClass = isChecked ? 'checked' : '';
                    const checkSymbol = isChecked ? '✓' : '';
                    
                    tableHtml += `<td>
                        <div class="habit-checkbox ${checkClass}" 
                             onclick="toggleHabitCheck(${habitIndex}, '${dateString}')"
                             title="Gewohnheit für ${weekdays[dayIndex]} abhaken">
                            ${checkSymbol}
                        </div>
                    </td>`;
                });
                
                tableHtml += '</tr>';
            });
            tableHtml += '</tbody></table>';
            
            container.innerHTML = tableHtml;
        }

        function isHabitChecked(habitIndex, date) {
            if (!appData.habitChecks) appData.habitChecks = {};
            return appData.habitChecks[`${habitIndex}-${date}`] === true;
        }

        function toggleHabitCheck(habitIndex, date) {
            if (!appData.habitChecks) appData.habitChecks = {};
            const key = `${habitIndex}-${date}`;
            appData.habitChecks[key] = !appData.habitChecks[key];
            updateHabitsWeekTable();
        }
    </script>
</body>
</html>
